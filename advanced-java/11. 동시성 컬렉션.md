## 11. 동시성 컬렉션

## 동시성 컬렉션이 필요한 이유
- 여러 스레드가 동시에 접근해도 괜찮은 경우를 `스레드 세이프`라고 한다.
- 컬렉션 프레임워크 대부분은 `스레드 세이프 하지 않는다.`
  - `ArrayList`, `LinkedList`, `HashSet`, `HashMap`


## 프록시 패턴
- 객체지향 디자인 패턴 중 하나로, 어떤 객체에 대한 접근을 제어하기 위해 그 객체의 대리인 또는 인터페이스 역할을 하는 객체를 제공하는 패턴이다.
- 프록시 객체는 실제 객체에 대한 참조를 유지하면서, 그 객체에 접근하거나 행동을 수행하기 전에 추가적인 처리를 할 수 있도록 한다.


### 프록시 패턴의 주요 목적
- **접근 제어**
  - 실제 객체에 대한 접근을 제한하거나 통제할 수 있다.
- **성능 향상**
  - 실제 객체의 생성을 지연시키거나 캐싱하여 성능을 최적화 할 수 있다.
- **부가 기능 제공**
  - 실제 객체에 추가적인 기능(로깅, 인증, 동기화 등)을 투명하게 제공할 수 있다.


## 자바 동시성 컬렉션
### 동시성 컬렉션
- 스레드 안전한 컬렉션을 뜻한다.
  - 예) `ConcurrentHashMap`, `CopyOnWriteArrayList`, `BlockingQueue` 등이 있다.
- 더 정교한 잠금 메커니즘을 사용하여 동시 접근을 효율적으로 처리하며, 필요한 경우 일부 메서드에 대해서만 동기화를 적용하는 등 유연한 동기화 전략을 제공한다.


### 동시성 컬렉션의 종류
- List
  - `CopyOnWriteArrayList` -> `ArrayList` 의 대안
- Set
  - `CopyOnWriteArraySet` -> `HashSet`의 대안
  - `ConcurrentSkipListSet` -> `TreeSet`의 대안 (정렬된 순서 유지, Comparator 사용 가능)
- Map
  - `ConcurrentHashMap` -> `HashMap`의 대안
  - `ConcurrentSkipListMap` -> `TreeMap`의 대안 (정렬된 순서 유지, Comparator 사용 가능)
- Queue
  - `ConcurrentLinkedQueue` -> 동시성 큐, 비 차단(non-blocking) 큐이다.
- Deque
  - `ConcurrentLinkedDeque` -> 동시성 데크, 비 차단(non-blocking) 큐이다.


## 정리
- 자바가 제공하는 동시성 컬렉션은 멀티스레드 상황에 최적의 성능을 낼 수 있도록 다양한 최적화 기법이 적용되어 있다.
- 당연한 이야기지만 동시성은 결국 성능과 트레이드 오프가 있다.
  - 따라서 단일 스레드가 컬렉션을 사용하는 경우에는 동시성 컬렉션이 아닌 일반 컬렉션을 사용해야 한다.
  - 반대로 멀티스레드 상황에서 일반 컬렉션을 사용하면 정말 해결하기 어려운 버그를 만날 수 있다.
- 세상에서 가장 해결하기 어려운 버그가 멀티스레드로 인해 발생한 버그이다.
  - 이러한 이유로 멀티스레드 환경에서는 동시성 컬렉션을 적절히 활용해서 버그를 예방하고 성능을 최적화하는 것이 중요하다.
  - 동시성 컬렉션을 사용하면 코드의 안정성과 효율성을 높일 수 있으며, 예상치 못한 동시성 문제도 방지할 수 있다.