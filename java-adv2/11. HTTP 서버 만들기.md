# 11. HTTP 서버 만들기
## URL 인코딩
### URL이 ASCII를 사용하는 이유
- 인터넷이 처음 설계되던 시기(1980~1990년대)에, 대부분의 컴퓨터 시스템은 ASCII 문자 집합을 사용했다.
- 전 세계에서 사용하는 다양한 컴퓨터 시스템과 네트워크 장비 간의 호환성을 보장하기 위해, URL은 단일한 문자 인코딩 체계를 사용해야 했다. 
  - 그 당시 모든 시스템이 비-ASCII 문자를 처리할 수 없었기 때문에, ASCII는 가장 보편적이고 일관된 선택이었다.
- HTTP URL이 ASCII만을 지원하는 이유는 초기 인터넷의 기술적 제약과 전 세계적인 호환성을 유지하기 위한 선택이다.
- 순수한 UTF-8로 URL을 표현하려면, 전 세계 모든 네트워크 장비, 서버, 클라이언트 소프트웨어가 이를 지원해야 한다. 
  - 그러나, 여전히 많은 시스템에서 ASCII 기반 표준에 의존하고 있기 때문에 순수한 UTF-8 URL을 사용하면 호환성 문제가 발생할 수 있다.
- HTTP 스펙은 매우 보수적이고, 호환성을 가장 우선시 한다


### 퍼센트(%) 인코딩
- 한글을 UTF-8 인코딩으로 표현하면 한 글자에 3byte의 데이터를 사용한다.
- 가, 나, 다를 UTF-8 인코딩의 16진수로 표현하면 다음과 같다.
  - 참고: 2진수는 (0, 1), 10진수는 (0 ~ 9), 16진수는(0~9, A, B, C, D, E, F 총 16개로 표현)
  - 가: EA,B0,80 (3byte)
  - 나: EB,82,98 (3byte)
  - 다: EB,8B,A4 (3byte)
- 이렇게 하면 약간 억지스럽기는 하지만 ASCII 문자를 사용해서 16진수로 표현된 UTF-8을 표현할 수 있다.
- 그리고 %EA%B0%80 는 모두 ASCII에 포함되는 문자이다.
  - 이렇게 각각의 16 진수 byte를 문자로 표현하고, 해당 문자 앞에 % 를 붙이는 것을 퍼센트( % ) 인코딩이라 한다.
- % 인코딩, 디코딩 진행 과정
  - 클라이언트: 가 전송 희망
  - 클라이언트 % 인코딩: %EA%B0%80
    - "가"를 UTF-8로 인코딩
    - EA , B0 , 80 3byte 획득
    - 각 byte를 16진수 문자로 표현하고 각각의 앞에 % 를 붙임
  - 클라이언트 서버 전송: q=%EA%B0%80
  - 서버: %EA%B0%80 ASCII 문자를 전달 받음
    - % 가 붙은 경우 디코딩해야 하는 문자로 인식
    -  EA , B0 , 80 을 byte로 변환, 3byte를 획득
    -  EA , B0 , 80 (3byte)를 UTF-8로 디코딩 문자 "가" 획득


## 웹 애플리케이션 서버의 역사
### 웹 애플리케이션 서버
- 실무 개발자가 목표라면, 웹 애플리케이션 서버(Web Application Server), 줄여서 WAS라는 단어를 많이 듣게 될 것이다.
  - Web Server가 이나라 중간에 Application이 들어가는 이유는, 웹 서버의 역할을 하면서 추가로 애플리케이션, 그러니까 프로그램 코드도 수행할 수 있는 서버라는 뜻이다.
- 정리하면 웹(HTTP)를 기반으로 작동하는 서버인데, 이 서버를 통해서 프로그램의 코드도 실행할 수 있는 서버라는 뜻이다. 
  - 여기서 말하는 프로그램의 코드는 바로 앞서 우리가 작성한 서블릿 구현체들이다.
- 우리가 작성한 서버는 HTTP 요청을 처리하는데, 이때 프로그램의 코드를 실행해서 HTTP 요청을 처리한다.
  - 이것이 바로 웹 애플리케이션 서버(WAS)이다.
  - 우리가 만든 was.httpserver 패키지도 서블릿 구현체들을 실행해서 프로그램의 코드를 작동할 수 있으므로 웹 애플리케이션 서버라 할 수 있다.


### 서블릿과 웹 애플리케이션 서버
- 1990년대 자바 진영에서는 서블릿(Servlet)이라는 표준이 등장하게 된다.
- 서블릿은 Servlet , HttpServlet , ServletRequest , ServletResponse 를 포함한 많은 표준을 제공한다.
- HTTP 서버를 만드는 회사들은 모두 서블릿을 기반으로 기능을 제공한다.
- 처음에는 javax.servlet 패키지를 사용했는데, 이후에 jakarta.servlet 으로 변경된다.
- 서블릿을 제공하는 주요 자바 웹 애플리케이션 서버(WAS)는 다음과 같다.
- 오픈소스
  - Apache Tomcat
  - Jetty
  - GlassFish
  - Undertow
- 상용
  - IBM WebSphere
  - Oracle WebLogic


### 표준화의 장점
- `개발자는 코드의 변경이 거의 없이 다른 애플리케이션 서버를 선택할 수 있고, 애플리케이션 서버를 만드는 입장에서도 사용자를 잃지 않으면서 더 나은 기능을 제공하는 데 집중할 수 있다.`
  - HTTP 서버를 만드는 회사들이 서블릿을 기반으로 기능을 제공한 덕분에, 개발자는 `jakarta.servlet.Servlet` 인터페이스를 구현하면 된다. 
  - 즉, 표준화된 서블릿 스펙 덕분에 애플리케이션 서버를 제공하는 회사들은 각자의 경쟁력을 키우기 위해 성능 최적화나 부가 기능, 관리 도구 등의 차별화 요소에 집중할 수 있고, 개발자들은 서버에 종속되지 않는 코드를 작성할 수 있는 자유를 얻게 된다.
- `개발 생태계 전반에 걸쳐 효율성과 생산성을 높여준다.`
  - 애플리케이션 서버의 선택에 따른 리스크가 줄어들고, 서버 교체나 환경 변화를 쉽게 받아들일 수 있게 되며, 이는 곧 유지 보수 비용 감소와 장기적인 안정성 확보로 이어진다.
  - 특히 대규모 시스템을 운영하는 기업들에게는 이러한 표준화된 기술 스택이 비용 절감과 더불어 운영의 유연성을 크게 높여준다.
- `서블릿 표준은 다양한 벤더들이 상호 운용 가능한 환경을 제공할 수 있게 만들어 주며, 이는 개발자와 기업 모두에게 큰 이점을 제공한다`